# Deploy Configuration Schema
# Each deployable component should have a deploy.yaml file
# that specifies how it should be deployed.

# =============================================================================
# TYPE: kubernetes
# For services deployed to Kubernetes clusters
# =============================================================================
# build:
#   type: docker                  # docker | npm | yarn | hugo | zip | none
#   context: .                    # Build context (use "." for repo root with shared packages)
#
# # PostgreSQL migrations (service-level)
# database:
#   type: postgresql
#   migrations: true              # Enable PostgreSQL migrations from {service}/migrations/
#
# targets:
#   dev:
#     type: kubernetes
#     runner: ubuntu-latest       # GitHub Actions runner (string or array)
#     namespace: develop          # Target namespace (must match kustomization.yaml)
#   staging:
#     type: kubernetes
#     runner: self-hosted
#     namespace: staging
#   prod:
#     type: kubernetes
#     runner: [self-hosted, production]
#     namespace: prod
#
# # Optional: Override default Kustomize paths
# kustomize:
#   base: k8s/base
#   overlays: k8s/overlays
#
# # Optional: Run MySQL/Flyway migrations before deploy (infra-level)
# migrations:
#   enabled: true
#   path: infra/mysql/migrations

# =============================================================================
# TYPE: server
# For applications deployed to traditional servers (Apache, Nginx, etc.)
# =============================================================================
# type: server
# method: rsync          # rsync | codedeploy
#
# targets:
#   dev:
#     type: server
#     method: rsync
#     runner: ubuntu-latest       # GitHub Actions runner (string or array)
#     hosts:
#       - web1.dev.example.com
#     path: /var/www/myapp
#     owner: www-data:www-data    # File ownership (user:group)
#     keep_releases: 5            # Number of releases to keep
#
#     # Shared directories (symlinked to shared/)
#     shared_dirs:
#       - storage
#       - uploads
#
#     # Shared files (symlinked to shared/)
#     shared_files:
#       - .env
#       - config/secrets.yml
#
#     # Config file deployment
#     config:
#       files:
#         - source: config/apache.conf       # Relative to service path
#           dest: /etc/apache2/sites-available/myapp.conf
#       post_config:                          # Commands after config deployed
#         - sudo systemctl reload apache2
#
#     # Post-deploy commands (run in release directory)
#     post_deploy:
#       - composer install --no-dev
#       - ./bin/migrate.sh
#       - sudo systemctl reload php-fpm
#
#     # Ansible playbook support (optional)
#     ansible:
#       playbook: ansible/playbooks/deploy.yml   # Path from repo root
#       extra_vars:
#         php_version: "8.2"
#
#   staging:
#     type: server
#     hosts:
#       - web1.staging.example.com
#       - web2.staging.example.com
#     path: /var/www/myapp
#
#   prod:
#     type: server
#     runner: [self-hosted, production]   # Can be array for labels
#     hosts:
#       - web1.example.com
#       - web2.example.com
#       - web3.example.com
#     path: /var/www/myapp

# =============================================================================
# TYPE: migration
# For database migrations only (RDS, Cloud SQL, etc.)
# No application deployment - just schema changes
# =============================================================================
# type: migration
# engine: flyway          # flyway | liquibase
# path: migrations        # Relative path to migration files
#
# # Connection configured via GitHub Secrets:
# # - DEV_DATABASE_URL, DEV_DATABASE_USER, DEV_DATABASE_PASSWORD
# # - STAGING_DATABASE_URL, STAGING_DATABASE_USER, STAGING_DATABASE_PASSWORD
# # - PROD_DATABASE_URL, PROD_DATABASE_USER, PROD_DATABASE_PASSWORD

# =============================================================================
# TYPE: static
# For static sites deployed to S3/CloudFront, Netlify, etc.
# =============================================================================
# type: static
# method: s3              # s3 | netlify | cloudflare-pages
#
# build:
#   command: npm run build
#   output: dist
#
# targets:
#   dev:
#     bucket: my-app-dev
#     cloudfront_distribution: E1234567890
#   prod:
#     bucket: my-app-prod
#     cloudfront_distribution: E0987654321
